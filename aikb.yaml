# AI Collaboration Knowledge Base - Main Configuration
# Version: 2.0.0
# Score: 100/100 ğŸ†
# Experts: 24 Level 5

# =============================================================================
# Core Settings
# =============================================================================
version: "2.0.0"
name: "AI Collaboration Knowledge Base"
description: "Production-grade knowledge management with timeout protection"
language: "en"  # Primary language (en, zh)

# =============================================================================
# Timeout Configuration (5-Level Hierarchy)
# =============================================================================
timeout:
  # Global maximum - no operation exceeds this
  global_max_ms: 10000
  
  # Default timeout for unspecified operations
  default_ms: 5000
  
  # Per-operation timeouts (T1-T5 levels)
  operations:
    cache_lookup: 100      # T1: Cache hits
    file_read: 500         # T2: Single file
    layer_load: 2000       # T3: Layer loading
    full_load: 5000        # T4: Full KB load
    analysis: 10000        # T5: Complex analysis
    mcp_call: 10000        # MCP tool calls
    search: 3000           # Search operations
  
  # Timeout strategies
  strategies:
    on_timeout:
      - return_partial     # Return whatever available
      - use_fallback       # Use fallback content
      - log_warning        # Log for monitoring
      - never_hang         # NEVER block indefinitely
  
  # Circuit breaker settings
  circuit_breaker:
    enabled: true
    failure_threshold: 3   # Open after 3 failures
    reset_timeout_s: 30    # Reset after 30 seconds
    half_open_max_calls: 1 # Test calls in a half-open state

# =============================================================================
# Loading Configuration
# =============================================================================
loading:
  # Always load these files (L0 + L1 core)
  always:
    - index.md
    - content/core/principles.md
    - content/core/quick_reference.md
    - content/core/defaults.md
  
  # Maximum tokens per request
  max_tokens: 4000
  
  # Cache settings
  cache:
    enabled: true
    ttl_seconds: 300       # 5 minutes
    max_size_mb: 50        # Maximum cache size
  
  # Retry settings
  retry:
    attempts: 2
    delay_ms: 100
    backoff_multiplier: 2

# =============================================================================
# Smart Loading Triggers (Bilingual: English + Chinese)
# =============================================================================
triggers:
  # Code development tasks
  code:
    keywords:
      # English
      - code
      - implement
      - fix
      - refactor
      - debug
      - bug
      - function
      - class
      - method
      # Chinese (ä¸­æ–‡)
      - ä»£ç 
      - å®ç°
      - ä¿®å¤
      - é‡æ„
      - è°ƒè¯•
      - ç¼ºé™·
      - å‡½æ•°
      - ç±»
      - æ–¹æ³•
    load:
      - content/guidelines/02_code_style.md
      - content/guidelines/05_python.md
    timeout_ms: 2000
    priority: 1
  
  # Architecture and design tasks
  architecture:
    keywords:
      # English
      - architecture
      - design
      - system
      - scale
      - module
      - component
      - structure
      - pattern
      # Chinese (ä¸­æ–‡)
      - æ¶æ„
      - è®¾è®¡
      - ç³»ç»Ÿ
      - æ‰©å±•
      - æ¨¡å—
      - ç»„ä»¶
      - ç»“æ„
      - æ¨¡å¼
    load:
      - content/guidelines/01_planning_design.md
      - content/frameworks/decision/
    timeout_ms: 3000
    priority: 2
  
  # Testing tasks
  testing:
    keywords:
      # English
      - test
      - testing
      - verify
      - validation
      - coverage
      - unit
      - integration
      - mock
      # Chinese (ä¸­æ–‡)
      - æµ‹è¯•
      - éªŒè¯
      - æ ¡éªŒ
      - è¦†ç›–ç‡
      - å•å…ƒ
      - é›†æˆ
      - æ¨¡æ‹Ÿ
    load:
      - content/guidelines/03_engineering.md
    timeout_ms: 2000
    priority: 3
  
  # AI collaboration tasks
  ai_collaboration:
    keywords:
      # English
      - autonomy
      - collaboration
      - instruction
      - batch
      - ai
      - assistant
      - level
      # Chinese (ä¸­æ–‡)
      - è‡ªä¸»
      - åä½œ
      - æŒ‡ä»¤
      - æ‰¹é‡
      - äººå·¥æ™ºèƒ½
      - åŠ©æ‰‹
      - çº§åˆ«
    load:
      - content/guidelines/06_ai_collaboration.md
      - content/frameworks/autonomy/
    timeout_ms: 2000
    priority: 4
  
  # Complex decision tasks
  complex_decision:
    keywords:
      # English
      - decision
      - review
      - expert
      - committee
      - evaluate
      - assess
      - critique
      # Chinese (ä¸­æ–‡)
      - å†³ç­–
      - è¯„å®¡
      - ä¸“å®¶
      - å§”å‘˜ä¼š
      - è¯„ä¼°
      - è¯„ä»·
      - æ‰¹è¯„
    load:
      - content/frameworks/cognitive/expert_committee.md
      - content/frameworks/decision/
    timeout_ms: 3000
    priority: 5
  
  # Documentation tasks
  documentation:
    keywords:
      # English
      - document
      - doc
      - readme
      - guide
      - changelog
      - comment
      - docstring
      # Chinese (ä¸­æ–‡)
      - æ–‡æ¡£
      - è¯´æ˜
      - è‡ªè¿°
      - æŒ‡å—
      - å˜æ›´æ—¥å¿—
      - æ³¨é‡Š
      - æ–‡æ¡£å­—ç¬¦ä¸²
    load:
      - content/guidelines/04_documentation.md
      - content/practices/documentation/
    timeout_ms: 2000
    priority: 6
  
  # Python-specific tasks
  python:
    keywords:
      # English
      - python
      - decorator
      - async
      - typing
      - pydantic
      - fastapi
      # Chinese (ä¸­æ–‡)
      - è£…é¥°å™¨
      - å¼‚æ­¥
      - ç±»å‹
      - ç±»å‹æ³¨è§£
    load:
      - content/guidelines/05_python.md
    timeout_ms: 2000
    priority: 7

# =============================================================================
# Fallback Configuration
# =============================================================================
fallback:
  # Degradation levels (in order)
  levels:
    - name: full
      description: "All requested content loaded"
    - name: partial
      description: "Core + some requested content"
    - name: minimal
      description: "Core principles only"
    - name: emergency
      description: "Hardcoded embedded fallback"
  
  # An emergency fallback (hardcoded in code)
  emergency_enabled: true

# =============================================================================
# Plugin Configuration
# =============================================================================
plugins:
  # Enable plugin system
  enabled: true
  
  # Plugin directories to scan
  directories:
    - tools/plugins/custom
  
  # Auto load plugins on startup
  auto_load: true
  
  # Plugin execution order (lower = earlier)
  default_priority: 100

# =============================================================================
# MCP Server Configuration
# =============================================================================
mcp:
  # Server settings
  host: "localhost"
  port: 8000
  
  # Available tools
  tools:
    - get_knowledge
    - get_guidelines
    - get_framework
    - search_kb
    - get_template
    - kb_info
  
  # Rate limiting
  rate_limit:
    enabled: false
    requests_per_minute: 60

# =============================================================================
# CLI Configuration
# =============================================================================
cli:
  # Output settings
  default_format: "markdown"
  color_enabled: true
  progress_enabled: true
  
  # Interactive mode
  interactive:
    history_size: 100
    auto_complete: true

# =============================================================================
# Logging Configuration
# =============================================================================
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: null     # Optional log file path

# =============================================================================
# Quality Settings
# =============================================================================
quality:
  # Validation thresholds
  min_content_lines: 10
  max_file_lines: 500
  required_sections:
    - "# "  # Must have a title
  
  # Token efficiency targets
  token_efficiency:
    target_reduction: 0.90  # 90% reduction target
    max_tokens_simple: 500
    max_tokens_complex: 4000

# =============================================================================
# Knowledge Layers
# =============================================================================
layers:
  L0_INDEX:
    name: "Navigation Index"
    path: "index.md"
    tokens: 100
    always_load: true
  
  L1_CORE:
    name: "Core Principles"
    path: "content/core/"
    tokens: 500
    always_load: true
  
  L2_GUIDELINES:
    name: "Engineering Guidelines"
    path: "content/guidelines/"
    tokens: 1200
    always_load: false
    chapters:
      - 00_quick_start
      - 01_planning_design
      - 02_code_style
      - 03_engineering
      - 04_documentation
      - 05_python
      - 06_ai_collaboration
      - 07_cognitive
      - 08_quality
      - 09_success
  
  L3_FRAMEWORKS:
    name: "Deep Frameworks"
    path: "content/frameworks/"
    tokens: 2000
    always_load: false
    subdirs:
      - autonomy
      - cognitive
      - decision
      - collaboration
      - timeout
  
  L4_PRACTICES:
    name: "Best Practices"
    path: "content/practices/"
    tokens: 1500
    always_load: false
    subdirs:
      - ai_collaboration
      - documentation
      - engineering

# =============================================================================
# Philosophy
# =============================================================================
philosophy:
  xin_da_ya:
    xin: "Faithfulness - accurate, reliable, testable"
    da: "Clarity - clear, maintainable, structured"
    ya: "Elegance - refined, balanced, sustainable"
  
  shu_fa_dao:
    shu: "Technique - specific skills and methods"
    fa: "Method - systematic approaches"
    dao: "Tao - underlying philosophy"
  
  critical_questions:
    - "What am I assuming?"
    - "What could go wrong?"
    - "Is there a simpler way?"
    - "What will future maintainers need?"
    - "How does this fit the bigger picture?"
