# Dependency Management

> Best practices for managing project dependencies in Python projects

---

## Table of Contents

- [1. Overview](#1-overview)

- [2. Dependency Specification](#2-dependency-specification)

- [3. Version Pinning](#3-version-pinning)

- [4. Security](#4-security)

- [5. Update Strategy](#5-update-strategy)

- [6. Environment Management](#6-environment-management)

---

## 1. Overview

### 1.1 Dependency Types

| Type            | Purpose          | Example             |

|-----------------|------------------|---------------------|

| **Runtime**     | Required to run  | `pyyaml`, `typer`   |

| **Development** | Testing, linting | `pytest`, `ruff`    |

| **Optional**    | Feature-specific | `uvicorn[standard]` |

| **Build**       | Package building | `build`, `twine`    |

### 1.2 Key Principles

- **Minimal Dependencies**: Only add what's necessary

- **Version Constraints**: Balance flexibility and stability

- **Regular Updates**: Keep dependencies current

- **Security First**: Monitor for vulnerabilities

---

## 2. Dependency Specification

### 2.1 pyproject.toml Structure

```toml
[project]

name = "knowledge-base"

version = "0.1.0"

requires-python = ">=3.12"

dependencies = [

    "pyyaml>=6.0",

    "typer>=0.9.0",

    "rich>=13.0",

    "pydantic-settings>=2.0",

    "structlog>=23.0",

]

[project.optional-dependencies]

dev = [

    "pytest>=7.4",

    "pytest-asyncio>=0.21",

    "pytest-cov>=4.1",

    "ruff>=0.1",

    "mypy>=1.5",

    "types-PyYAML",

]

mcp = [

    "fastmcp>=0.1",

]

api = [

    "fastapi>=0.100",

    "uvicorn[standard]>=0.23",

]

all = [

    "knowledge-base[dev,mcp,api]",

]

```
### 2.2 Version Specifiers

| Specifier  | Meaning            | Example              |

|------------|--------------------|----------------------|

| `>=X.Y`    | Minimum version    | `>=1.0`              |

| `>=X.Y,<Z` | Version range      | `>=1.0,<2.0`         |

| `~=X.Y`    | Compatible release | `~=1.4` (≥1.4, <2.0) |

| `==X.Y.Z`  | Exact version      | `==1.2.3`            |

| `!=X.Y.Z`  | Exclude version    | `!=1.2.3`            |

### 2.3 Extras for Optional Features

```toml
# Install with specific extras

# pip install knowledge-base[mcp]

# pip install knowledge-base[api]

# pip install knowledge-base[all]

```
---

## 3. Version Pinning

### 3.1 Pinning Strategy

| Environment     | Strategy          | File                  |

|-----------------|-------------------|-----------------------|

| **Library**     | Loose constraints | `pyproject.toml`      |

| **Application** | Lock file         | `requirements.lock`   |

| **CI/CD**       | Pinned versions   | `requirements-ci.txt` |

### 3.2 Lock File Generation

```bash
# Generate lock file with pip-tools

pip install pip-tools

pip-compile pyproject.toml -o requirements.lock

# With hashes for security

pip-compile --generate-hashes pyproject.toml

# Update lock file

pip-compile --upgrade pyproject.toml

```
### 3.3 Lock File Example

```txt
# requirements.lock

# Generated by pip-compile

pyyaml==6.0.1 \

    --hash=sha256:...

typer==0.9.0 \

    --hash=sha256:...

rich==13.7.0 \

    --hash=sha256:...

```
---

## 4. Security

### 4.1 Vulnerability Scanning

```bash
# Install pip-audit

pip install pip-audit

# Scan current environment

pip-audit

# Scan requirements file

pip-audit -r requirements.lock

# Output as JSON

pip-audit --format json -o audit.json

```
### 4.2 GitHub Dependabot

```yaml
# .github/dependabot.yml

version: 2

updates:

  - package-ecosystem: "pip"

    directory: "/"

    schedule:

      interval: "weekly"

    open-pull-requests-limit: 10

    groups:

      dev-dependencies:

        patterns:

          - "pytest*"

          - "ruff"

          - "mypy"

```
### 4.3 Security Best Practices

| Practice           | Description                  |

|--------------------|------------------------------|

| **Use lock files** | Ensure reproducible builds   |

| **Verify hashes**  | Prevent supply chain attacks |

| **Regular audits** | Weekly security scans        |

| **Pin CI deps**    | Avoid surprise breaks        |

| **Review updates** | Don't blindly update         |

---

## 5. Update Strategy

### 5.1 Update Frequency

| Dependency Type    | Frequency | Approach        |

|--------------------|-----------|-----------------|

| **Security fixes** | Immediate | Patch ASAP      |

| **Bug fixes**      | Weekly    | Batch updates   |

| **Minor versions** | Monthly   | Test thoroughly |

| **Major versions** | Quarterly | Plan migration  |

### 5.2 Update Process

```bash
# 1. Check for outdated packages

pip list --outdated

# 2. Update lock file

pip-compile --upgrade pyproject.toml

# 3. Install updated dependencies

pip install -r requirements.lock

# 4. Run tests

pytest

# 5. Commit changes

git add requirements.lock

git commit -m "chore(deps): update dependencies"

```
### 5.3 Handling Breaking Changes

1. **Read changelog** before updating major versions

2. **Create branch** for major updates

3. **Update incrementally** if multiple majors behind

4. **Run full test suite** after updates

5. **Document migration** steps if needed

---

## 6. Environment Management

### 6.1 Conda Environment (Recommended)

Miniconda is the recommended virtual environment management tool.

```yaml
# environment.yml

name: knowledge-base

channels:

  - conda-forge

  - defaults

dependencies:

  - python=3.12

  - pip

  - pip:

      - -e ".[all]"

```
```bash
# Create environment

conda env create -f environment.yml

# Activate

conda activate knowledge-base

# Update

conda env update -f environment.yml

# Deactivate

conda deactivate

```
### 6.2 Virtual Environments (venv Alternative)

```bash
# Create virtual environment

python -m venv .venv

# Activate (Linux/macOS)

source .venv/bin/activate

# Activate (Windows)

.venv\Scripts\activate

# Install dependencies

pip install -e ".[dev]"

```
### 6.3 Development Setup

```bash
# Full development setup (using conda - recommended)

git clone https://github.com/org/knowledge-base.git

cd knowledge-base

conda env create -f environment.yml

conda activate knowledge-base

pip install -e ".[all]"

pre-commit install

```
---

## Quick Reference

```bash
# Check outdated

pip list --outdated

# Install with extras

pip install -e ".[dev,mcp,api]"

# Generate lock file

pip-compile pyproject.toml -o requirements.lock

# Security audit

pip-audit

# Upgrade single package

pip install --upgrade package-name

# Show dependency tree

pip install pipdeptree

pipdeptree

```
---

## Dependency Checklist

| Check                   | Frequency |

|-------------------------|-----------|

| Run `pip-audit`         | Weekly    |

| Update lock file        | Weekly    |

| Review Dependabot PRs   | Weekly    |

| Check for major updates | Monthly   |

| Audit unused deps       | Quarterly |

---

## Related

- `.knowledge/practices/engineering/CI_CD.md` — CI/CD pipeline with dependency checks

- `.knowledge/practices/engineering/TESTING_STRATEGY.md` — Testing after updates

- `.knowledge/guidelines/PYTHON.md` — Python coding standards

---

*AI Collaboration Knowledge Base*

