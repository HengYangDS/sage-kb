# SAGE Plugin Configuration
#
# Configuration for the plugin loader and bundled plugins.
# This file is part of the modular configuration system.
#
# Structure:
#   plugins.loader      - Master controls for plugin behavior
#   plugins.event_handler - Event handler configuration
#   plugins.loading     - Plugin loading configuration
#   plugins.bundled.*   - Individual plugin configurations
#
# Note: Plugins are auto-configured when registered via PluginRegistry.register()
#       Configuration is loaded from `plugins.bundled.<plugin_name>`.

# =============================================================================
# Plugin Configuration
# =============================================================================
plugins:
  # Master controls for plugin loader behavior
  loader:
    # Master toggle for content caching (overrides bundled.content_cache.enabled)
    cache_enabled: true
    # Default TTL for cache (used if bundled.content_cache.ttl_seconds not set)
    cache_ttl: 300                     # 5 minutes

  # Event handler configuration (from 05-plugin-memory.md)
  event_handler:
    timeout_ms: 1000                   # Single handler timeout
    max_concurrent: 10                 # Maximum concurrent handlers

  # Plugin loading configuration
  loading:
    auto_discover: true                # Auto-discover plugins
    plugin_dir: "plugins"              # Custom plugins directory
    disabled: [ ]                       # List of disabled plugins

  # Bundled plugin configurations
  # Each plugin is configured at plugins.bundled.<plugin_name>
  bundled:
    # ContentCachePlugin - LRU caching for knowledge content
    content_cache:
      enabled: true                    # Enable/disable caching
      max_entries: 1000                # Maximum cache entries
      max_size_bytes: 52428800         # 50MB maximum cache size
      ttl_seconds: 3600                # 1 hour TTL

    # SemanticSearchPlugin - Semantic search capabilities
    semantic_search:
      enabled: true                    # Enable/disable search
      min_term_length: 2               # Minimum term length to index
      max_results: 20                  # Maximum search results
      score_threshold: 0.1             # Minimum relevance score
      use_stemming: false              # Enable basic stemming

  # ===========================================================================
  # Plugin Sandbox Configuration
  # ===========================================================================
  sandbox:
    enabled: true                      # Enable plugin sandboxing
    timeout_ms: 5000                   # Plugin execution timeout
    max_memory_mb: 128                 # Maximum memory per plugin

    # Allowed imports for plugins
    allowed_imports:
      - typing
      - dataclasses
      - pathlib
      - collections
      - functools
      - itertools
      - re
      - json
      - datetime
      - enum
      - abc

    # Blocked operations
    blocked_operations:
      - file_write                     # Block file writes
      - network_access                 # Block network access
      - subprocess                     # Block subprocess execution
      - eval                           # Block eval/exec

    # Resource limits
    limits:
      max_cpu_time_seconds: 5          # CPU time limit
      max_file_descriptors: 10         # Open file limit
      max_threads: 4                   # Thread limit

  # ===========================================================================
  # Plugin Health Check Configuration
  # ===========================================================================
  health_check:
    enabled: true                      # Enable plugin health checks
    interval_seconds: 60               # Check interval
    timeout_ms: 2000                   # Health check timeout
    failure_threshold: 3               # Failures before marking unhealthy
    recovery_threshold: 2              # Successes before marking healthy

    # Actions on unhealthy plugins
    on_unhealthy:
      disable_plugin: true             # Disable unhealthy plugins
      notify: true                     # Send notification
      auto_restart: true               # Attempt auto-restart
      max_restart_attempts: 3          # Maximum restart attempts

  # ===========================================================================
  # Plugin Priority Configuration
  # ===========================================================================
  priority:
    # Lower number = higher priority (executed first)
    content_cache: 1                   # Cache should run first
    semantic_search: 2                 # Search after cache
    # Default priority for unlisted plugins
    default: 10

  # ===========================================================================
  # Plugin Lifecycle Configuration
  # ===========================================================================
  lifecycle:
    # Startup behavior
    startup:
      parallel: true                   # Load plugins in parallel
      timeout_ms: 10000                # Total startup timeout
      fail_fast: false                 # Stop on first failure

    # Shutdown behavior
    shutdown:
      timeout_ms: 5000                 # Graceful shutdown timeout
      order: reverse_priority          # Shutdown in reverse priority order

  # ===========================================================================
  # Plugin Metrics Configuration
  # ===========================================================================
  metrics:
    enabled: true                      # Enable plugin metrics
    track_execution_time: true         # Track execution time
    track_memory_usage: true           # Track memory usage
    track_error_rate: true             # Track error rate
    track_call_count: true             # Track call count
